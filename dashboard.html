<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyD8C74L3VddED8ToArBcU0ZCUPZUsjoXeU",
    authDomain: "streamnova-4dbc3.firebaseapp.com",
    projectId: "streamnova-4dbc3",
    storageBucket: "streamnova-4dbc3.firebasestorage.app",
    messagingSenderId: "834796110267",
    appId: "1:834796110267:web:070b24b6ed05d2664fc49e",
    measurementId: "G-K00DN1ZM5Q"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  // Firestore setup
  const db = firebase.firestore();

  // Auth check
  firebase.auth().onAuthStateChanged((user) => {
    if (user) {
      document.getElementById("welcome-msg").innerText = `👋 Hello, ${user.email}`;
    } else {
      document.getElementById("welcome-msg").innerText = "❌ Not logged in. Redirecting...";
      setTimeout(() => {
        window.location.href = "auth.html";
      }, 2000);
    }
  });

  // Logout
  function logOut() {
    firebase.auth().signOut().then(() => {
      window.location.href = "auth.html";
    });
  }

  // Save Tip Link to Firestore
  function saveTipLink() {
    const method = document.getElementById("tip-method").value;
    const link = document.getElementById("tip-link").value;
    const user = firebase.auth().currentUser;

    if (!link || !method) {
      alert("Please select a tip method and enter your link.");
      return;
    }

    if (!user) {
      alert("User is not logged in yet. Please wait a moment.");
      return;
    }

    db.collection("users").doc(user.uid).set({
      email: user.email,
      tipMethod: method,
      tipLink: link
    }).then(() => {
      document.getElementById("tip-status").innerText = "✅ Tip settings saved successfully!";
    }).catch((error) => {
      console.error("❌ Firestore error:", error);
      document.getElementById("tip-status").innerText = `❌ Error: ${error.message}`;
    });
  }
</script>
